#! /usr/bin/env bash
existing=$(docker ps -f name=tensorboard$1 -q)
if [[ $existing != "" ]]
then
  echo docker kill $existing 
  docker kill $existing 
fi
if [[ $# -gt 1 ]]
then
  volumes="${@:2}"
else
  recent=$(docker ps -q -n 1)
  volumes=$(docker inspect --format='{{range .Mounts}}{{.Name}}{{end}}' $recent)
fi
volume_args=()
for v in $volumes; do
  echo $v
  volume_args+=("-v $v:/log/$v")
  echo $volume_args
done
my_ip=$(ip route get 8.8.8.8 | awk -F"src " 'NR==1{split($2,a," ");print a[1]}')
cmd="docker run --rm -itd --label RUN --name tensorboard$1 ${volume_args[@]} -p $my_ip:$1:6006 tensorboard"
echo $cmd
id=$(exec $cmd)
echo docker logs -f $id
docker logs -f $id
